<div class="todo-container">
    <mat-card class="todo-card">
        <mat-card-header class="todo-header">
            <mat-card-title class="todo-title">My Todo List</mat-card-title>
        </mat-card-header>
        <mat-card-content>
            
            <!-- 1. Action Row (Add/Clear) -->
            <div class="action-row">
                <button mat-flat-button color="accent" class="add-task-btn" (click)="openForm()">
                    <mat-icon>add_circle_outline</mat-icon> Add Task
                </button>
                <button mat-button class="clear-btn" (click)="clearAll()">Clear</button>
            </div>
            
            <mat-divider class="top-divider"></mat-divider>

            <!-- 2. Filter & Search Row -->
            <div class="filter-search-row">
                <!-- Reactive Form Control for Filter Status -->
                <mat-form-field appearance="outline" class="filter-select">
                    <mat-label>Filter Status</mat-label>
                    <mat-select [formControl]="filterStatusControl">
                        <mat-option value="all">All</mat-option>
                        <mat-option *ngFor="let status of taskStatuses" [value]="status">
                            {{ status | titlecase }}
                        </mat-option>
                    </mat-select>
                </mat-form-field>

                <!-- Reactive Form Control for Search -->
                <mat-form-field appearance="outline" class="search-input-field">
                    <input matInput 
                           placeholder="Search tasks..." 
                           [formControl]="searchControl">
                    <mat-icon matSuffix>search</mat-icon>
                </mat-form-field>
            </div>

            <mat-divider></mat-divider>

            <!-- 3. Task List -->
            <div class="task-list">
                
                <!-- Conditional Display for Empty/No Match States -->
                <mat-card *ngIf="filteredTasks().length === 0" class="no-tasks-card">
                    <mat-card-content class="no-tasks-content">
                        <ng-container *ngIf="searchControl.value || filterStatusControl.value !== 'all'">
                            <mat-icon>sentiment_dissatisfied</mat-icon> 
                            No tasks found matching your criteria.
                        </ng-container>
                        <ng-container *ngIf="!searchControl.value && filterStatusControl.value === 'all'">
                            <mat-icon>lightbulb_outline</mat-icon> 
                            No tasks available. Click 'Add Task' to create one!
                        </ng-container>
                    </mat-card-content>
                </mat-card>
                
                <!-- Uses the TaskViewCardComponent -->
                <app-task-view-card 
                    *ngFor="let task of filteredTasks(); trackBy: trackById" 
                    [task]="task"
                    (editTask)="openForm($event)"
                    (deleteTask)="deleteTask($event)"
                ></app-task-view-card>
            </div>

        </mat-card-content>
    </mat-card>
    
   <!-- Modal and Overlay -->
    <!-- CRITICAL: The (close) output event triggers the closeForm() method -->
    <app-task-form 
        *ngIf="showTaskForm()" 
        [task]="taskToEdit" 
        (closeForm)="closeForm()"
    ></app-task-form>
    
    <!-- Overlay also controlled by *ngIf -->
    <div *ngIf="showTaskForm()" class="overlay"></div>
</div>
