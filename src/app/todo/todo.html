<div class="todo-container">
    <mat-card class="todo-card">
        <mat-card-header class="todo-header"> <mat-card-title class="todo-title">My Todo List</mat-card-title>
        </mat-card-header>
        <mat-card-content>

            <div class="input-row">
                <mat-form-field appearance="outline" class="task-input-field">
                    <input matInput placeholder="Enter new task..." [(ngModel)]="newTaskTitle"
                        (keyup.enter)="addTask()">
                </mat-form-field>

                <mat-form-field appearance="outline" class="search-input-field">
                    <input matInput placeholder="Search..." [formControl]="searchControl">
                    <mat-icon matSuffix>search</mat-icon>
                </mat-form-field>

            </div>

            <div class="controls-row">
                <button mat-flat-button color="accent" (click)="addTask()">Add Task</button>
                <button mat-button class="clear-btn" (click)="clearAll()">Clear All</button>

                <mat-form-field appearance="fill" class="filter-select">
                    <mat-label>Filter Status</mat-label>
                    <mat-select [(ngModel)]="filterStatus" (ngModelChange)="applyStatusFilter($event)">
                        <mat-option value="all">All</mat-option>
                        <mat-option *ngFor="let status of taskStatuses.slice(0, 4)" [value]="status">
                            {{ status | titlecase }}
                        </mat-option>
                    </mat-select>
                </mat-form-field>
            </div>

            <mat-divider></mat-divider>

            <div class="task-list" *ngIf="filteredTasks$ | async as tasks; else loading">
                <mat-card *ngIf="tasks.length === 0" class="no-tasks-card">
                    <mat-card-content>
                        No tasks found. Start adding one!
                    </mat-card-content>
                </mat-card>

                <mat-card *ngFor="let task of tasks; trackBy: trackById" class="task-item-card">
                    <mat-card-content class="task-content">
                        <div class="task-details">
                            <span class="task-title">{{ task.title }}</span>
                            <span class="status-badge" [ngClass]="'badge-' + task.status">
                                {{ task.status }}
                            </span>
                            <span class="task-date">{{ task.date }}</span>
                        </div>

                        <div class="task-actions">
                            <mat-form-field appearance="fill" class="status-select-field">
                                <mat-select [value]="task.status" (selectionChange)="changeStatus(task, $event.value)">
                                    <mat-option *ngFor="let status of taskStatuses.slice(0, 4)" [value]="status">
                                        {{ status | titlecase }}
                                    </mat-option>
                                </mat-select>
                            </mat-form-field>
                            <button mat-icon-button color="warn" (click)="deleteTask(task.id)" title="Delete Task">
                                <mat-icon>delete</mat-icon>
                            </button>
                        </div>
                    </mat-card-content>
                </mat-card>
            </div>

            <ng-template #loading>
                <p>Loading tasks...</p>
            </ng-template>

        </mat-card-content>
    </mat-card>
</div>