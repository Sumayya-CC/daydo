<div class="todo-container">
    <mat-card class="todo-card">
        <mat-card-header class="todo-header">
            <mat-card-title class="todo-title">My Todo List</mat-card-title>
        </mat-card-header>
        <mat-card-content>
            
            <!-- 1. Action Row (Add/Clear) - Stays on top left -->
            <div class="action-row">
                <!-- Added custom class for vibrant primary button style -->
                <button mat-flat-button color="accent" class="add-task-btn" (click)="openForm()">
                    <mat-icon>add_circle_outline</mat-icon> Add Task
                </button>
                <button mat-button class="clear-btn" (click)="clearAll()">Clear All Tasks</button>
            </div>
            
            <mat-divider class="top-divider"></mat-divider>

            <!-- 2. Filter & Search Row - Next line, balanced -->
            <div class="filter-search-row">
                <!-- Filter Select -->
                <mat-form-field appearance="outline" class="filter-select">
                    <mat-label>Filter Status</mat-label>
                    <mat-select [formControl]="filterStatusControl">
                        <mat-option value="all">All</mat-option>
                        <mat-option *ngFor="let status of taskStatuses" [value]="status">
                            {{ status | titlecase }}
                        </mat-option>
                    </mat-select>
                </mat-form-field>

                <!-- Search Input -->
                <mat-form-field appearance="outline" class="search-input-field">
                    <input matInput 
                           placeholder="Search tasks..." 
                           [formControl]="searchControl">
                    <mat-icon matSuffix>search</mat-icon>
                </mat-form-field>
            </div>

            <mat-divider></mat-divider>

            <!-- 3. Task List (Signal Access) -->
            <div class="task-list">
                
                <mat-card *ngIf="filteredTasks().length === 0" class="no-tasks-card">
                    <mat-card-content class="no-tasks-content">
                        <ng-container *ngIf="searchControl.value || filterStatusControl.value !== 'all'">
                            <mat-icon>sentiment_dissatisfied</mat-icon> 
                            No tasks found matching your criteria.
                        </ng-container>
                        <ng-container *ngIf="!searchControl.value && filterStatusControl.value === 'all'">
                            <mat-icon>lightbulb_outline</mat-icon> 
                            No tasks available. Click 'Add Task' to create one!
                        </ng-container>
                    </mat-card-content>
                </mat-card>
                
                <mat-card *ngFor="let task of filteredTasks(); trackBy: trackById" class="task-item-card">
                    <mat-card-content class="task-content">
                        <div class="task-details">
                            <span class="task-title">{{ task.title }}</span>
                            <p class="task-description">{{ task.description || 'No description provided.' }}</p>
                            
                            <!-- Task Meta (Chips/Badges) -->
                            <div class="task-meta">
                                <span class="meta-chip status-chip" [ngClass]="'status-' + task.status">
                                    {{ task.status | titlecase }} 
                                </span>
                                <span class="meta-chip priority-chip" [ngClass]="'priority-' + task.priority">
                                    Priority: {{ task.priority | titlecase }}
                                </span>
                                <span class="task-date">Due: {{ task.date }}</span>
                            </div>
                        </div>
                        
                        <div class="task-actions">
                            <button mat-icon-button color="primary" (click)="openForm(task)" title="Edit Task" class="edit-btn">
                                <mat-icon>edit</mat-icon>
                            </button>
                            <button mat-icon-button color="warn" (click)="deleteTask(task.id)" title="Delete Task" class="delete-btn">
                                <mat-icon>delete</mat-icon>
                            </button>
                        </div>
                    </mat-card-content>
                </mat-card>
            </div>

        </mat-card-content>
    </mat-card>
    
    <app-task-form 
        *ngIf="showTaskForm" 
        [task]="taskToEdit" 
        (close)="closeForm()"
    ></app-task-form>
    
    <div *ngIf="showTaskForm" class="overlay"></div>
</div>